# Kubernetes MCP Server Helm Values for KCP
# This configuration deploys the MCP server to work with kcp control planes
# using OIDC bearer token authentication (same provider as kcp front-proxy)

# Replica count for the deployment
replicaCount: 1

# Container image configuration
image:
  registry: ghcr.io
  repository: mjudeikis/kubernetes-mcp-server
  version: latest
  pullPolicy: Always

# Service configuration - expose HTTPS on port 443, forward to container port 8443
service:
  type: LoadBalancer
  port: 8443
  targetPort: 8443
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: nlb
    service.beta.kubernetes.io/aws-load-balancer-nlb-target-type: ip
    service.beta.kubernetes.io/aws-load-balancer-scheme: internet-facing

# Ingress disabled - using TLS termination at the application level
ingress:
  enabled: false

# Service account configuration
serviceAccount:
  create: true
  annotations: {}
  name: ""

# RBAC configuration - disable default RBAC as we use kcp's RBAC
rbac:
  create: false

# Pod security context
podSecurityContext:
  seccompProfile:
    type: RuntimeDefault

# Container security context
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  runAsNonRoot: true

# Resource limits and requests
resources:
  limits:
    cpu: 100m
    memory: 128Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Extra volumes for mounting base kubeconfig and TLS certs
# The kubeconfig provides cluster endpoint/TLS only (no auth credentials)
# Authentication is handled via OIDC bearer tokens
# Note: config is handled by the chart via config.existingConfigMap
extraVolumes:
  - name: kubeconfig
    secret:
      secretName: kcp-mcp-kubeconfig
  - name: tls-certs
    secret:
      secretName: mcp-tls

# Extra volume mounts
# Mount to different paths to avoid conflicts with chart's default mounts
extraVolumeMounts:
  - name: kubeconfig
    mountPath: /etc/kcp-mcp/kube
    readOnly: true
  - name: tls-certs
    mountPath: /etc/kcp-mcp/tls
    readOnly: true

# Configuration file path
configFilePath: /etc/kcp-mcp/config/config.toml

# MCP Server configuration - this becomes TOML via the chart's toToml function
config:
  port: "8443"
  cluster_provider_strategy: "kcp"
  kubeconfig: "/etc/kcp-mcp/kube/kubeconfig"
  require_oauth: true
  authorization_url: "https://auth.keycloak.example.com/realms/kcp"
  oauth_audience: "kcp"
  tls_cert: "/etc/kcp-mcp/tls/tls.crt"
  tls_key: "/etc/kcp-mcp/tls/tls.key"
  toolsets:
    - "kcp"
    - "core"
  disabled_tools:
    - "pods_list"
    - "pods_list_in_namespace"
    - "pods_get"
    - "pods_delete"
    - "pods_top"
    - "pods_exec"
    - "pods_log"
    - "pods_run"
    - "nodes_log"
    - "nodes_stats_summary"
    - "nodes_top"

# Liveness and readiness probes - use HTTPS scheme on port 8443
livenessProbe:
  httpGet:
    path: /healthz
    port: 8443
    scheme: HTTPS

readinessProbe:
  httpGet:
    path: /healthz
    port: 8443
    scheme: HTTPS

# Node selector, tolerations, and affinity
nodeSelector: {}
tolerations: []
affinity: {}

# Pod annotations and labels
podAnnotations: {}
podLabels: {}
